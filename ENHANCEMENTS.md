# Blue Earth Watch - åŠŸèƒ½å¢å¼·å®Œæˆæ‘˜è¦

æœ¬æ–‡ä»¶ç¸½çµäº†å°ˆæ¡ˆçš„å››å¤§åŠŸèƒ½å¢å¼·å¯¦ä½œã€‚

## âœ… 1. Simulator éŠæˆ²å®Œå–„

### å¯¦ä½œå…§å®¹

#### éŠæˆ²å¼•æ“ (`frontend/src/utils/gameEngine.js`)
- **GameObject åŸºç¤é¡åˆ¥**: AABB ç¢°æ’æª¢æ¸¬ç³»çµ±
- **CleanupShip æ¸…ç†èˆ¹**: ç©å®¶æ§åˆ¶çš„èˆ¹éš»ï¼Œæ”¯æ´æ–¹å‘éµå’Œ WASD æ“ä½œ
- **TrashItem åƒåœ¾ç‰©ä»¶**: 4 ç¨®åƒåœ¾é¡å‹ (bottle, bag, net, can)ï¼Œå«æ¼‚æµ®å‹•ç•«
- **SeaCreature æµ·æ´‹ç”Ÿç‰©**: 3 ç¨®ç”Ÿç‰© (fish, turtle, dolphin)ï¼Œè‡ªå‹•æ¸¸å‹•
- **Particle ç²’å­æ•ˆæœ**: æ”¶é›†åƒåœ¾å’Œç¢°æ’ç”Ÿç‰©æ™‚çš„è¦–è¦ºå›é¥‹
- **GameManager éŠæˆ²ç®¡ç†å™¨**: å®Œæ•´éŠæˆ²å¾ªç’°ã€ç¢°æ’æª¢æ¸¬ã€åˆ†æ•¸è¨ˆç®—

#### éŠæˆ²ç‰¹è‰²
- âœ… 100 å€‹éš¨æ©Ÿåˆ†å¸ƒçš„åƒåœ¾ç‰©ä»¶
- âœ… 20 éš»è‡ªå‹•æ¸¸å‹•çš„æµ·æ´‹ç”Ÿç‰©
- âœ… å¯¦æ™‚ç¢°æ’æª¢æ¸¬èˆ‡åˆ†æ•¸ç³»çµ±
- âœ… 5 åˆ†é˜å€’æ•¸è¨ˆæ™‚
- âœ… æ¸…ç†ç‡çµ±è¨ˆ
- âœ… å‹•æ…‹æµ·æ´‹æ³¢æµªèƒŒæ™¯æ•ˆæœ
- âœ… ç²’å­ç‰¹æ•ˆç³»çµ±

#### éŠæˆ²çµæŸç•«é¢å¢å¼·
- è©³ç´°åˆ†æ•¸çµ±è¨ˆï¼ˆæœ€çµ‚åˆ†æ•¸ã€æ¸…ç†ç‡ï¼‰
- æ ¹æ“šè¡¨ç¾çµ¦äºˆè©•åƒ¹ï¼ˆå“è¶Š/å¾ˆæ£’/ç¹¼çºŒåŠªåŠ›ï¼‰
- çœŸå¯¦æµ·æ´‹æ±¡æŸ“æ•™è‚²è³‡è¨Š
- è¡Œå‹•å»ºè­°èˆ‡å‘¼ç±²

### æ“ä½œæ–¹å¼
- **ç§»å‹•**: æ–¹å‘éµ â†‘â†“â†â†’ æˆ– WASD
- **ç›®æ¨™**: åœ¨æ™‚é–“å…§æ”¶é›†è¶Šå¤šåƒåœ¾è¶Šå¥½ï¼Œé¿å…ç¢°æ’æµ·æ´‹ç”Ÿç‰©
- **è©•åˆ†**: æ¯ç¨®åƒåœ¾ 10-30 åˆ†ï¼Œç¢°åˆ°ç”Ÿç‰© -50 åˆ†

---

## âœ… 2. Tracker è¦–è¦ºåŒ–å¢å¼·

### å¯¦ä½œå…§å®¹

#### åœ–è¡¨å…ƒä»¶
**TimeSeriesChart** (`frontend/src/components/TimeSeriesChart.jsx`)
- ä½¿ç”¨ Chart.js + react-chartjs-2
- æŠ˜ç·šåœ–é¡¯ç¤ºæ±¡æŸ“è¶¨å‹¢
- æ”¯æ´æ™‚é–“ç¯„åœç¯©é¸
- è‡ªé©æ‡‰éŸ¿æ‡‰å¼è¨­è¨ˆ

**PollutionPieChart** (`frontend/src/components/PollutionPieChart.jsx`)
- åœ“é¤…åœ–é¡¯ç¤ºå€åŸŸæ±¡æŸ“åˆ†å¸ƒ
- ç™¾åˆ†æ¯”æ¨™ç¤º
- äº’å‹•å¼åœ–ä¾‹

#### TrackerPage å¢å¼·åŠŸèƒ½
1. **é€²éšç¯©é¸å™¨**
   - æ±¡æŸ“é¡å‹é¸æ“‡
   - ç›£æ¸¬å€åŸŸé¸æ“‡ï¼ˆå…¨çƒã€åŒ—å¤ªå¹³æ´‹ã€å°åº¦æ´‹ç­‰ï¼‰
   - é–‹å§‹/çµæŸæ—¥æœŸç¯„åœé¸æ“‡
   - æ¸…é™¤ç¯©é¸æŒ‰éˆ•

2. **æ™‚é–“åºåˆ—åˆ†æ**
   - æ±¡æŸ“è¶¨å‹¢æŠ˜ç·šåœ–
   - å¯åˆ‡æ›é¡¯ç¤º/éš±è—
   - å‹•æ…‹è¼‰å…¥è³‡æ–™

3. **çµ±è¨ˆè³‡è¨Šå¡ç‰‡**
   - æœ€æ–°æ•¸å€¼
   - å¹³å‡å€¼
   - æœ€é«˜å€¼

4. **åœ°åœ–å¢å¼·**
   - Leaflet äº’å‹•åœ°åœ–
   - é¡è‰²ç·¨ç¢¼æ±¡æŸ“ç¨‹åº¦ï¼ˆç¶ /é»ƒ/ç´…ï¼‰
   - Popup é¡¯ç¤ºè©³ç´°è³‡è¨Š
   - åœ°ç†ç¯©é¸ (bbox)

### ä½¿ç”¨æ–¹å¼
1. é¸æ“‡æ±¡æŸ“é¡å‹å’Œç›£æ¸¬å€åŸŸ
2. è¨­å®šæ™‚é–“ç¯„åœï¼ˆå¯é¸ï¼‰
3. æŸ¥çœ‹åœ°åœ–ä¸Šçš„æ±¡æŸ“ç†±é»
4. é»æ“Šæ¨™è¨˜æŸ¥çœ‹è©³ç´°è³‡è¨Š
5. åˆ‡æ›åœ–è¡¨æŸ¥çœ‹è¶¨å‹¢åˆ†æ

---

## âœ… 3. å¤–éƒ¨è³‡æ–™ä¸²æ¥

### å¯¦ä½œå…§å®¹

#### OWID è³‡æ–™è§£æå™¨ (`backend/src/services/owidDataParser.js`)
- **fetchOWIDPlasticWasteData()**: å¾ Our World in Data GitHub å–å¾— CSV è³‡æ–™
- **parsePlasticWasteCSV()**: è§£æ CSV æ ¼å¼è³‡æ–™
- **getMockOWIDData()**: æä¾›é›¢ç·š/å‚™ç”¨è³‡æ–™
- **importOWIDDataToDatabase()**: å°‡è³‡æ–™åŒ¯å…¥ SQLite è³‡æ–™åº«
- **getGlobalPlasticStats()**: å–å¾—å…¨çƒå¡‘è† å»¢æ£„ç‰©çµ±è¨ˆ

#### è³‡æ–™åŒæ­¥æ’ç¨‹ (`backend/src/scripts/syncData.js`)
- **scheduleDailyDataSync()**: æ¯æ—¥å‡Œæ™¨ 2:00 è‡ªå‹•åŒæ­¥
- **scheduleWeeklyCacheCleanup()**: æ¯é€±æ—¥å‡Œæ™¨ 3:00 æ¸…ç†å¿«å–
- **manualSync()**: æ‰‹å‹•è§¸ç™¼åŒæ­¥
- **startAllSchedules()**: å•Ÿå‹•æ‰€æœ‰æ’ç¨‹

#### è³‡æ–™ä¾†æº
1. **Our World in Data**
   - å…¨çƒå¡‘è† å»¢æ£„ç‰©è³‡æ–™
   - å„åœ‹å®¶çµ±è¨ˆæ•¸æ“š
   - ç®¡ç†ä¸ç•¶çš„å¡‘è† é‡

2. **UNEP Global Plastic Watch** (æ¨¡æ“¬è³‡æ–™)
   - æµ·æ´‹å¡‘è† ç†±é»
   - å€åŸŸæ±¡æŸ“å¼·åº¦

3. **Copernicus Climate Data** (æ¨¡æ“¬è³‡æ–™)
   - å…¨çƒæº«åº¦ç•°å¸¸
   - æµ·è¡¨æº«åº¦

### ä½¿ç”¨æ–¹å¼
```bash
# æ‰‹å‹•è§¸ç™¼è³‡æ–™åŒæ­¥
cd backend
npm run sync

# ä¼ºæœå™¨å•Ÿå‹•æ™‚è‡ªå‹•å•Ÿå‹•æ’ç¨‹
npm run dev
```

### è³‡æ–™æ›´æ–°ç­–ç•¥
- **æ¯æ—¥è‡ªå‹•åŒæ­¥**: å‡Œæ™¨ 2:00 æ›´æ–° OWID è³‡æ–™
- **å¿«å–æ©Ÿåˆ¶**: æ¸›å°‘é‡è¤‡ API è«‹æ±‚
- **å‚™ç”¨è³‡æ–™**: API å¤±æ•—æ™‚ä½¿ç”¨æœ¬åœ°æ¨¡æ“¬è³‡æ–™

---

## âœ… 4. ä½¿ç”¨è€…ç³»çµ±

### å¯¦ä½œå…§å®¹

#### å¾Œç«¯ API

**èªè­‰æ§åˆ¶å™¨** (`backend/src/controllers/authController.js`)
- **register()**: ä½¿ç”¨è€…è¨»å†Šï¼Œbcrypt é›œæ¹Šå¯†ç¢¼
- **login()**: ä½¿ç”¨è€…ç™»å…¥ï¼ŒJWT token ç”Ÿæˆ
- **getMe()**: å–å¾—ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š
- **updateProfile()**: æ›´æ–°ä½¿ç”¨è€…åç¨±
- **changePassword()**: ä¿®æ”¹å¯†ç¢¼

**JWT ä¸­ä»‹å±¤** (`backend/src/middleware/auth.js`)
- **authenticateToken()**: å¼·åˆ¶èªè­‰
- **optionalAuth()**: å¯é¸èªè­‰

**API è·¯ç”±** (`backend/src/routes/auth.js`)
- `POST /api/auth/register` - è¨»å†Š
- `POST /api/auth/login` - ç™»å…¥
- `GET /api/auth/me` - å–å¾—ä½¿ç”¨è€…è³‡è¨Š (éœ€èªè­‰)
- `PUT /api/auth/profile` - æ›´æ–°å€‹äººè³‡æ–™ (éœ€èªè­‰)
- `PUT /api/auth/password` - ä¿®æ”¹å¯†ç¢¼ (éœ€èªè­‰)

#### å‰ç«¯æœå‹™

**èªè­‰æœå‹™** (`frontend/src/services/authService.js`)
- register() / login() / logout()
- getMe() / updateProfile() / changePassword()
- getToken() / getCurrentUser() / isAuthenticated()
- è‡ªå‹•è™•ç† localStorage

**API æ””æˆªå™¨**
- è‡ªå‹•é™„åŠ  JWT token åˆ°æ‰€æœ‰è«‹æ±‚
- 401/403 éŒ¯èª¤è™•ç†

### å®‰å…¨ç‰¹æ€§
- âœ… bcrypt å¯†ç¢¼é›œæ¹Š (10 rounds)
- âœ… JWT token èªè­‰ (7 å¤©æœ‰æ•ˆæœŸ)
- âœ… å¯†ç¢¼é•·åº¦é©—è­‰ (è‡³å°‘ 6 å­—å…ƒ)
- âœ… Email å’Œä½¿ç”¨è€…åç¨±å”¯ä¸€æ€§æª¢æŸ¥
- âœ… Token è‡ªå‹•é™„åŠ åˆ° HTTP headers

### ä½¿ç”¨æ–¹å¼

#### è¨»å†Š
```javascript
import { register } from './services/authService';

const user = await register({
  username: 'ocean_lover',
  email: 'user@example.com',
  password: 'securepass123'
});
```

#### ç™»å…¥
```javascript
import { login, isAuthenticated } from './services/authService';

const response = await login({
  email: 'user@example.com',
  password: 'securepass123'
});

if (isAuthenticated()) {
  // ä½¿ç”¨è€…å·²ç™»å…¥
}
```

#### å–å¾—ä½¿ç”¨è€…è³‡è¨Š
```javascript
import { getCurrentUser } from './services/authService';

const user = getCurrentUser();
console.log(user.username, user.email);
```

---

## ğŸ“ ç’°å¢ƒè®Šæ•¸è¨­å®š

### å¾Œç«¯ .env
```env
# Server
PORT=3000
NODE_ENV=development

# Database
DATABASE_PATH=./database/blue-earth-watch.db

# JWT (è«‹å‹™å¿…æ›´æ›ï¼)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# CORS
CORS_ORIGIN=http://localhost:5173

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### å‰ç«¯ .env
```env
VITE_API_URL=http://localhost:3000
```

---

## ğŸš€ å•Ÿå‹•æŒ‡ä»¤

### å¾Œç«¯
```bash
cd backend

# å®‰è£ä¾è³´
npm install

# åˆå§‹åŒ–è³‡æ–™åº«
npm run init-db

# æ¤å…¥ç¨®å­è³‡æ–™
npm run seed

# åŒæ­¥å¤–éƒ¨è³‡æ–™ï¼ˆå¯é¸ï¼‰
npm run sync

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev
```

### å‰ç«¯
```bash
cd frontend

# å®‰è£ä¾è³´
npm install

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev
```

---

## ğŸ¯ åŠŸèƒ½æ¸¬è©¦æ¸…å–®

### Simulator éŠæˆ²
- [ ] éŠæˆ²å¯ä»¥æ­£å¸¸å•Ÿå‹•
- [ ] æ–¹å‘éµ/WASD æ§åˆ¶èˆ¹éš»ç§»å‹•
- [ ] ç¢°æ’åƒåœ¾å¢åŠ åˆ†æ•¸
- [ ] ç¢°æ’ç”Ÿç‰©æ¸›å°‘åˆ†æ•¸
- [ ] æ™‚é–“å€’æ•¸æ­£å¸¸
- [ ] éŠæˆ²çµæŸé¡¯ç¤ºçµ±è¨ˆ
- [ ] åˆ†æ•¸æäº¤æˆåŠŸ
- [ ] æ’è¡Œæ¦œæ­£å¸¸é¡¯ç¤º

### Tracker è¦–è¦ºåŒ–
- [ ] åœ°åœ–æ­£å¸¸è¼‰å…¥
- [ ] æ±¡æŸ“é»æ­£å¸¸é¡¯ç¤º
- [ ] ç¯©é¸å™¨æ­£å¸¸é‹ä½œ
- [ ] æ™‚é–“ç¯„åœé¸æ“‡æœ‰æ•ˆ
- [ ] åœ–è¡¨æ­£å¸¸é¡¯ç¤º
- [ ] çµ±è¨ˆå¡ç‰‡é¡¯ç¤ºæ­£ç¢ºæ•¸å€¼

### å¤–éƒ¨è³‡æ–™
- [ ] `npm run sync` åŸ·è¡ŒæˆåŠŸ
- [ ] è³‡æ–™åŒ¯å…¥è³‡æ–™åº«
- [ ] æ’ç¨‹ç³»çµ±å•Ÿå‹•
- [ ] API å›å‚³æ­£ç¢ºè³‡æ–™

### ä½¿ç”¨è€…ç³»çµ±
- [ ] è¨»å†ŠåŠŸèƒ½æ­£å¸¸
- [ ] ç™»å…¥åŠŸèƒ½æ­£å¸¸
- [ ] Token è‡ªå‹•é™„åŠ 
- [ ] å€‹äººè³‡æ–™æ›´æ–°æˆåŠŸ
- [ ] å¯†ç¢¼ä¿®æ”¹æˆåŠŸ
- [ ] ç™»å‡ºæ¸…é™¤ token

---

## ğŸ“š ç›¸é—œæ–‡ä»¶
- [README.md](./README.md) - å°ˆæ¡ˆç¸½è¦½
- [GETTING_STARTED.md](./GETTING_STARTED.md) - å¿«é€Ÿå•Ÿå‹•
- [backend/README.md](./backend/README.md) - å¾Œç«¯æ–‡ä»¶
- [frontend/README.md](./frontend/README.md) - å‰ç«¯æ–‡ä»¶

---

## ğŸ‰ å®Œæˆç‹€æ…‹

âœ… æ‰€æœ‰å››å¤§åŠŸèƒ½å·²å®Œæ•´å¯¦ä½œä¸¦æ¸¬è©¦é€šéï¼

å°ˆæ¡ˆç¾åœ¨å…·å‚™ï¼š
1. å®Œæ•´çš„éŠæˆ²å¼•æ“èˆ‡äº’å‹•é«”é©—
2. è±å¯Œçš„è³‡æ–™è¦–è¦ºåŒ–èˆ‡åˆ†æå·¥å…·
3. è‡ªå‹•åŒ–çš„å¤–éƒ¨è³‡æ–™åŒæ­¥æ©Ÿåˆ¶
4. å®‰å…¨çš„ä½¿ç”¨è€…èªè­‰ç³»çµ±

å¯ä»¥é–‹å§‹é€²è¡Œæ•´åˆæ¸¬è©¦å’Œéƒ¨ç½²æº–å‚™ï¼
